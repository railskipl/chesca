%h1 Product display order

- form_for [:admin, :products], :url => { :controller => 'admin/products', :action => 'display_order' }, :html => { :method => :post } do |f|
  %table#product-display-order{ :cellpadding => 0, :cellspacing => 0 }
    - @products.group_by(&:department).each do |department, products|
      - count = 1
      %thead
        %tr
          %th{ :colspan => 5 }
            - if department.nil?
              Other
            - else
              = department.name
      %tbody
        - products.each do |product|
          %tr
            %td.count== #{count}.
            %td.name= product.name
            %td.views
              = text_field_tag "display_order[#{product.id}]", product.display_order || count
          - count = count + 1
  .center
    = f.submit 'Update'

- content_for :bottom do
  :javascript
    $('product-display-order').observe('click', function(event) {
      var target = event.element();
      if(target.match('th')) {
        var tbody = target.up('thead').next('tbody');

        if(tbody.rolling)
          return;

        tbody.rolling = true;
        if(tbody.visible()) {
          Effect.BlindUp(tbody, { duration: 0.4, afterFinish: function() {
            tbody.rolling = false;
          } });
        }
        else {
          Effect.BlindDown(tbody, { duration: 0.4, afterFinish: function() {
            tbody.rolling = false;
          } });
        }
      }
    });

